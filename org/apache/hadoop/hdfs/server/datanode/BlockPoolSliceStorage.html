<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_80) on Wed Jun 10 23:54:06 EDT 2015 -->
<title>BlockPoolSliceStorage</title>
<meta name="date" content="2015-06-10">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="BlockPoolSliceStorage";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/BlockPoolSliceStorage.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolManager.html" title="class in org.apache.hadoop.hdfs.server.datanode"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockReceiver.html" title="class in org.apache.hadoop.hdfs.server.datanode"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html" target="_top">Frames</a></li>
<li><a href="BlockPoolSliceStorage.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested_classes_inherited_from_class_org.apache.hadoop.hdfs.server.common.Storage">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.hadoop.hdfs.server.datanode</div>
<h2 title="Class BlockPoolSliceStorage" class="title">Class BlockPoolSliceStorage</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li><a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html" title="class in org.apache.hadoop.hdfs.server.common">org.apache.hadoop.hdfs.server.common.StorageInfo</a></li>
<li>
<ul class="inheritance">
<li><a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html" title="class in org.apache.hadoop.hdfs.server.common">org.apache.hadoop.hdfs.server.common.Storage</a></li>
<li>
<ul class="inheritance">
<li>org.apache.hadoop.hdfs.server.datanode.BlockPoolSliceStorage</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>@InterfaceAudience.Private
public class <a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.65">BlockPoolSliceStorage</a>
extends <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html" title="class in org.apache.hadoop.hdfs.server.common">Storage</a></pre>
<div class="block">Manages storage for the set of BlockPoolSlices which share a particular 
 block pool id, on this DataNode.
 
 This class supports the following functionality:
 <ol>
 <li> Formatting a new block pool storage</li>
 <li> Recovering a storage state to a consistent state (if possible></li>
 <li> Taking a snapshot of the block pool during upgrade</li>
 <li> Rolling back a block pool to a previous snapshot</li>
 <li> Finalizing block storage by deletion of a snapshot</li>
 </ul></div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html" title="class in org.apache.hadoop.hdfs.server.common"><code>Storage</code></a></dd></dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="nested_class_summary">
<!--   -->
</a>
<h3>Nested Class Summary</h3>
<ul class="blockList">
<li class="blockList"><a name="nested_classes_inherited_from_class_org.apache.hadoop.hdfs.server.common.Storage">
<!--   -->
</a>
<h3>Nested classes/interfaces inherited from class&nbsp;org.apache.hadoop.hdfs.server.common.<a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html" title="class in org.apache.hadoop.hdfs.server.common">Storage</a></h3>
<code><a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.FormatConfirmable.html" title="interface in org.apache.hadoop.hdfs.server.common">Storage.FormatConfirmable</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirType.html" title="interface in org.apache.hadoop.hdfs.server.common">Storage.StorageDirType</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageState.html" title="enum in org.apache.hadoop.hdfs.server.common">Storage.StorageState</a></code></li>
</ul>
</li>
</ul>
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static <a href="https://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html?is-external=true" title="class or interface in java.util.regex">Pattern</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#BLOCK_POOL_CURRENT_PATH_PATTERN">BLOCK_POOL_CURRENT_PATH_PATTERN</a></strong></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private static <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#BLOCK_POOL_ID_PATTERN_BASE">BLOCK_POOL_ID_PATTERN_BASE</a></strong></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static <a href="https://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html?is-external=true" title="class or interface in java.util.regex">Pattern</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#BLOCK_POOL_PATH_PATTERN">BLOCK_POOL_PATH_PATTERN</a></strong></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private static <a href="https://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html?is-external=true" title="class or interface in java.util.regex">Pattern</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#BLOCK_POOL_TRASH_PATH_PATTERN">BLOCK_POOL_TRASH_PATH_PATTERN</a></strong></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#blockpoolID">blockpoolID</a></strong></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>(package private) static <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#ROLLING_UPGRADE_MARKER_FILE">ROLLING_UPGRADE_MARKER_FILE</a></strong></code>
<div class="block">A marker file that is created on each root directory if a rolling upgrade
 is in progress.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Set.html?is-external=true" title="class or interface in java.util">Set</a>&lt;<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#storagesWithoutRollingUpgradeMarker">storagesWithoutRollingUpgradeMarker</a></strong></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private static <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Set.html?is-external=true" title="class or interface in java.util">Set</a>&lt;<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#storagesWithRollingUpgradeMarker">storagesWithRollingUpgradeMarker</a></strong></code>
<div class="block">These maps are used as an optimization to avoid one filesystem operation
 per storage on each heartbeat response.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>(package private) static <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#TRASH_ROOT_DIR">TRASH_ROOT_DIR</a></strong></code>&nbsp;</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="fields_inherited_from_class_org.apache.hadoop.hdfs.server.common.Storage">
<!--   -->
</a>
<h3>Fields inherited from class&nbsp;org.apache.hadoop.hdfs.server.common.<a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html" title="class in org.apache.hadoop.hdfs.server.common">Storage</a></h3>
<code><a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#LAST_PRE_UPGRADE_LAYOUT_VERSION">LAST_PRE_UPGRADE_LAYOUT_VERSION</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#LAST_UPGRADABLE_HADOOP_VERSION">LAST_UPGRADABLE_HADOOP_VERSION</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#LAST_UPGRADABLE_LAYOUT_VERSION">LAST_UPGRADABLE_LAYOUT_VERSION</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#LAYOUT_VERSIONS_203">LAYOUT_VERSIONS_203</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#LOG">LOG</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#STORAGE_1_BBW">STORAGE_1_BBW</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#STORAGE_DIR_CURRENT">STORAGE_DIR_CURRENT</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#STORAGE_DIR_PREVIOUS">STORAGE_DIR_PREVIOUS</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#STORAGE_FILE_LOCK">STORAGE_FILE_LOCK</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#STORAGE_PREVIOUS_CKPT">STORAGE_PREVIOUS_CKPT</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#STORAGE_TMP_FINALIZED">STORAGE_TMP_FINALIZED</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#STORAGE_TMP_LAST_CKPT">STORAGE_TMP_LAST_CKPT</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#STORAGE_TMP_PREVIOUS">STORAGE_TMP_PREVIOUS</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#STORAGE_TMP_REMOVED">STORAGE_TMP_REMOVED</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#storageDirs">storageDirs</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="fields_inherited_from_class_org.apache.hadoop.hdfs.server.common.StorageInfo">
<!--   -->
</a>
<h3>Fields inherited from class&nbsp;org.apache.hadoop.hdfs.server.common.<a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html" title="class in org.apache.hadoop.hdfs.server.common">StorageInfo</a></h3>
<code><a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#clusterID">clusterID</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#cTime">cTime</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#layoutVersion">layoutVersion</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#namespaceID">namespaceID</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#STORAGE_FILE_VERSION">STORAGE_FILE_VERSION</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#storageType">storageType</a></code></li>
</ul>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier</th>
<th class="colLast" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private </code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#BlockPoolSliceStorage()">BlockPoolSliceStorage</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>(package private)</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#BlockPoolSliceStorage(int,%20java.lang.String,%20long,%20java.lang.String)">BlockPoolSliceStorage</a></strong>(int&nbsp;namespaceID,
                                          <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;bpID,
                                          long&nbsp;cTime,
                                          <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;clusterId)</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>&nbsp;</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#BlockPoolSliceStorage(org.apache.hadoop.hdfs.server.common.StorageInfo,%20java.lang.String)">BlockPoolSliceStorage</a></strong>(<a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html" title="class in org.apache.hadoop.hdfs.server.common">StorageInfo</a>&nbsp;storageInfo,
                                          <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;bpid)</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#addStorageDir(org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">addStorageDir</a></strong>(<a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&nbsp;sd)</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#cleanupDetachDir(java.io.File)">cleanupDetachDir</a></strong>(<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;detachDir)</code>
<div class="block">Cleanup the detachDir.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#clearRollingUpgradeMarkers(java.util.List)">clearRollingUpgradeMarkers</a></strong>(<a href="https://docs.oracle.com/javase/7/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&gt;&nbsp;dnStorageDirs)</code>
<div class="block">Check whether the rolling upgrade marker file exists for each BP storage
 root.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>(package private) void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#doFinalize(java.io.File)">doFinalize</a></strong>(<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;dnCurDir)</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>(package private) void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#doRollback(org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory,%20org.apache.hadoop.hdfs.server.protocol.NamespaceInfo)">doRollback</a></strong>(<a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&nbsp;bpSd,
                    <a href="../../../../../../org/apache/hadoop/hdfs/server/protocol/NamespaceInfo.html" title="class in org.apache.hadoop.hdfs.server.protocol">NamespaceInfo</a>&nbsp;nsInfo)</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#doTransition(org.apache.hadoop.hdfs.server.datanode.DataNode,%20org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory,%20org.apache.hadoop.hdfs.server.protocol.NamespaceInfo,%20org.apache.hadoop.hdfs.server.common.HdfsServerConstants.StartupOption)">doTransition</a></strong>(<a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/DataNode.html" title="class in org.apache.hadoop.hdfs.server.datanode">DataNode</a>&nbsp;datanode,
                        <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&nbsp;sd,
                        <a href="../../../../../../org/apache/hadoop/hdfs/server/protocol/NamespaceInfo.html" title="class in org.apache.hadoop.hdfs.server.protocol">NamespaceInfo</a>&nbsp;nsInfo,
                        <a href="../../../../../../org/apache/hadoop/hdfs/server/common/HdfsServerConstants.StartupOption.html" title="enum in org.apache.hadoop.hdfs.server.common">HdfsServerConstants.StartupOption</a>&nbsp;startOpt)</code>
<div class="block">Analyze whether a transition of the BP state is required and
 perform it if necessary.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>(package private) void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#doUpgrade(org.apache.hadoop.hdfs.server.datanode.DataNode,%20org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory,%20org.apache.hadoop.hdfs.server.protocol.NamespaceInfo)">doUpgrade</a></strong>(<a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/DataNode.html" title="class in org.apache.hadoop.hdfs.server.datanode">DataNode</a>&nbsp;datanode,
                  <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&nbsp;bpSd,
                  <a href="../../../../../../org/apache/hadoop/hdfs/server/protocol/NamespaceInfo.html" title="class in org.apache.hadoop.hdfs.server.protocol">NamespaceInfo</a>&nbsp;nsInfo)</code>
<div class="block">Upgrade to any release after 0.22 (0.22 included) release e.g.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>(package private) void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#format(java.io.File,%20org.apache.hadoop.hdfs.server.protocol.NamespaceInfo)">format</a></strong>(<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;dnCurDir,
            <a href="../../../../../../org/apache/hadoop/hdfs/server/protocol/NamespaceInfo.html" title="class in org.apache.hadoop.hdfs.server.protocol">NamespaceInfo</a>&nbsp;nsInfo)</code>
<div class="block">Format a block pool slice storage.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#format(org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory,%20org.apache.hadoop.hdfs.server.protocol.NamespaceInfo)">format</a></strong>(<a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&nbsp;bpSdir,
            <a href="../../../../../../org/apache/hadoop/hdfs/server/protocol/NamespaceInfo.html" title="class in org.apache.hadoop.hdfs.server.protocol">NamespaceInfo</a>&nbsp;nsInfo)</code>
<div class="block">Format a block pool slice storage.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static <a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#getBpRoot(java.lang.String,%20java.io.File)">getBpRoot</a></strong>(<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;bpID,
                  <a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;dnCurDir)</code>
<div class="block">Get a block pool storage root based on data node storage root</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#getDataNodeStorageRoot(java.lang.String)">getDataNodeStorageRoot</a></strong>(<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;bpRoot)</code>
<div class="block">gets the data node storage directory based on block pool storage</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>(package private) <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#getRestoreDirectory(java.io.File)">getRestoreDirectory</a></strong>(<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;blockFile)</code>
<div class="block">Get a target subdirectory under current/ for a given block file that is being
 restored from trash.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#getTrashDirectory(java.io.File)">getTrashDirectory</a></strong>(<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;blockFile)</code>
<div class="block">Get a target subdirectory under trash/ for a given block file that is being
 deleted.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private <a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#getTrashRootDir(org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">getTrashRootDir</a></strong>(<a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&nbsp;sd)</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#isPreUpgradableLayout(org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">isPreUpgradableLayout</a></strong>(<a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&nbsp;sd)</code>
<div class="block">Return true if the layout of the given storage directory is from a version
 of Hadoop prior to the introduction of the "current" and "previous"
 directories which allow upgrade and rollback.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#isTrashAllowed(java.io.File)">isTrashAllowed</a></strong>(<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;blockFile)</code>
<div class="block">Determine whether we can use trash for the given blockFile.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#linkAllBlocks(org.apache.hadoop.hdfs.server.datanode.DataNode,%20java.io.File,%20java.io.File)">linkAllBlocks</a></strong>(<a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/DataNode.html" title="class in org.apache.hadoop.hdfs.server.datanode">DataNode</a>&nbsp;datanode,
                          <a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;fromDir,
                          <a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;toDir)</code>
<div class="block">Hardlink all finalized and RBW blocks in fromDir to toDir</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>(package private) <a href="https://docs.oracle.com/javase/7/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#loadBpStorageDirectories(org.apache.hadoop.hdfs.server.datanode.DataNode,%20org.apache.hadoop.hdfs.server.protocol.NamespaceInfo,%20java.util.Collection,%20org.apache.hadoop.hdfs.server.common.HdfsServerConstants.StartupOption)">loadBpStorageDirectories</a></strong>(<a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/DataNode.html" title="class in org.apache.hadoop.hdfs.server.datanode">DataNode</a>&nbsp;datanode,
                                                <a href="../../../../../../org/apache/hadoop/hdfs/server/protocol/NamespaceInfo.html" title="class in org.apache.hadoop.hdfs.server.protocol">NamespaceInfo</a>&nbsp;nsInfo,
                                                <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Collection.html?is-external=true" title="class or interface in java.util">Collection</a>&lt;<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&gt;&nbsp;dataDirs,
                                                <a href="../../../../../../org/apache/hadoop/hdfs/server/common/HdfsServerConstants.StartupOption.html" title="enum in org.apache.hadoop.hdfs.server.common">HdfsServerConstants.StartupOption</a>&nbsp;startOpt)</code>
<div class="block">Analyze and load storage directories.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#loadStorageDirectory(org.apache.hadoop.hdfs.server.datanode.DataNode,%20org.apache.hadoop.hdfs.server.protocol.NamespaceInfo,%20java.io.File,%20org.apache.hadoop.hdfs.server.common.HdfsServerConstants.StartupOption)">loadStorageDirectory</a></strong>(<a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/DataNode.html" title="class in org.apache.hadoop.hdfs.server.datanode">DataNode</a>&nbsp;datanode,
                                        <a href="../../../../../../org/apache/hadoop/hdfs/server/protocol/NamespaceInfo.html" title="class in org.apache.hadoop.hdfs.server.protocol">NamespaceInfo</a>&nbsp;nsInfo,
                                        <a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;dataDir,
                                        <a href="../../../../../../org/apache/hadoop/hdfs/server/common/HdfsServerConstants.StartupOption.html" title="enum in org.apache.hadoop.hdfs.server.common">HdfsServerConstants.StartupOption</a>&nbsp;startOpt)</code>
<div class="block">Load one storage directory.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>(package private) void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#recoverTransitionRead(org.apache.hadoop.hdfs.server.datanode.DataNode,%20org.apache.hadoop.hdfs.server.protocol.NamespaceInfo,%20java.util.Collection,%20org.apache.hadoop.hdfs.server.common.HdfsServerConstants.StartupOption)">recoverTransitionRead</a></strong>(<a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/DataNode.html" title="class in org.apache.hadoop.hdfs.server.datanode">DataNode</a>&nbsp;datanode,
                                          <a href="../../../../../../org/apache/hadoop/hdfs/server/protocol/NamespaceInfo.html" title="class in org.apache.hadoop.hdfs.server.protocol">NamespaceInfo</a>&nbsp;nsInfo,
                                          <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Collection.html?is-external=true" title="class or interface in java.util">Collection</a>&lt;<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&gt;&nbsp;dataDirs,
                                          <a href="../../../../../../org/apache/hadoop/hdfs/server/common/HdfsServerConstants.StartupOption.html" title="enum in org.apache.hadoop.hdfs.server.common">HdfsServerConstants.StartupOption</a>&nbsp;startOpt)</code>
<div class="block">Analyze storage directories.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>(package private) void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#remove(java.io.File)">remove</a></strong>(<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;absPathToRemove)</code>
<div class="block">Remove block pool level storage directory.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private int</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#restoreBlockFilesFromTrash(java.io.File)">restoreBlockFilesFromTrash</a></strong>(<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;trashRoot)</code>
<div class="block">Restore all files from the trash directory to their corresponding
 locations under current/</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#restoreTrash()">restoreTrash</a></strong>()</code>
<div class="block">Delete all files and directories in the trash directories.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#setBlockPoolID(java.io.File,%20java.lang.String)">setBlockPoolID</a></strong>(<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;storage,
                            <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;bpid)</code>
<div class="block">Validate and set block pool ID</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#setFieldsFromProperties(java.util.Properties,%20org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">setFieldsFromProperties</a></strong>(<a href="https://docs.oracle.com/javase/7/docs/api/java/util/Properties.html?is-external=true" title="class or interface in java.util">Properties</a>&nbsp;props,
                                              <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&nbsp;sd)</code>
<div class="block">Get common storage fields.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#setPropertiesFromFields(java.util.Properties,%20org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">setPropertiesFromFields</a></strong>(<a href="https://docs.oracle.com/javase/7/docs/api/java/util/Properties.html?is-external=true" title="class or interface in java.util">Properties</a>&nbsp;props,
                                              <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&nbsp;sd)</code>
<div class="block">Set layoutVersion, namespaceID and blockpoolID into block pool storage
 VERSION file</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#setRollingUpgradeMarkers(java.util.List)">setRollingUpgradeMarkers</a></strong>(<a href="https://docs.oracle.com/javase/7/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&gt;&nbsp;dnStorageDirs)</code>
<div class="block">Create a rolling upgrade marker file for each BP storage root, if it
 does not exist already.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#toString()">toString</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#trashEnabled()">trashEnabled</a></strong>()</code>
<div class="block">trash is enabled if at least one storage directory contains trash root</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_org.apache.hadoop.hdfs.server.common.Storage">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;org.apache.hadoop.hdfs.server.common.<a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html" title="class in org.apache.hadoop.hdfs.server.common">Storage</a></h3>
<code><a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#checkVersionUpgradable(int)">checkVersionUpgradable</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#confirmFormat(java.lang.Iterable,%20boolean,%20boolean)">confirmFormat</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#containsStorageDir(java.io.File)">containsStorageDir</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#deleteDir(java.io.File)">deleteDir</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#dirIterable(org.apache.hadoop.hdfs.server.common.Storage.StorageDirType)">dirIterable</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#dirIterator()">dirIterator</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#dirIterator(boolean)">dirIterator</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#dirIterator(org.apache.hadoop.hdfs.server.common.Storage.StorageDirType)">dirIterator</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#dirIterator(org.apache.hadoop.hdfs.server.common.Storage.StorageDirType,%20boolean)">dirIterator</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#getBuildVersion()">getBuildVersion</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#getFiles(org.apache.hadoop.hdfs.server.common.Storage.StorageDirType,%20java.lang.String)">getFiles</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#getNumStorageDirs()">getNumStorageDirs</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#getRegistrationID(org.apache.hadoop.hdfs.server.common.StorageInfo)">getRegistrationID</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#getSingularStorageDir()">getSingularStorageDir</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#getStorageDir(int)">getStorageDir</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#is203LayoutVersion(int)">is203LayoutVersion</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#listStorageDirectories()">listStorageDirectories</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#nativeCopyFileUnbuffered(java.io.File,%20java.io.File,%20boolean)">nativeCopyFileUnbuffered</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#rename(java.io.File,%20java.io.File)">rename</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#unlockAll()">unlockAll</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#writeAll()">writeAll</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#writeProperties(java.io.File,%20org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">writeProperties</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#writeProperties(java.io.File,%20org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory,%20java.util.Properties)">writeProperties</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#writeProperties(org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">writeProperties</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_org.apache.hadoop.hdfs.server.common.StorageInfo">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;org.apache.hadoop.hdfs.server.common.<a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html" title="class in org.apache.hadoop.hdfs.server.common">StorageInfo</a></h3>
<code><a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#checkStorageType(java.util.Properties,%20org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">checkStorageType</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#getClusterID()">getClusterID</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#getClusterIdFromColonSeparatedString(java.lang.String)">getClusterIdFromColonSeparatedString</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#getCTime()">getCTime</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#getLayoutVersion()">getLayoutVersion</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#getNamespaceID()">getNamespaceID</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#getNsIdFromColonSeparatedString(java.lang.String)">getNsIdFromColonSeparatedString</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#getProperty(java.util.Properties,%20org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory,%20java.lang.String)">getProperty</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#getServiceLayoutFeatureMap()">getServiceLayoutFeatureMap</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#getServiceLayoutVersion()">getServiceLayoutVersion</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#readPreviousVersionProperties(org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">readPreviousVersionProperties</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#readProperties(org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">readProperties</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#readPropertiesFile(java.io.File)">readPropertiesFile</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#setClusterId(java.util.Properties,%20int,%20org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">setClusterId</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#setcTime(java.util.Properties,%20org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">setcTime</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#setLayoutVersion(java.util.Properties,%20org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">setLayoutVersion</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#setNamespaceID(java.util.Properties,%20org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">setNamespaceID</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#setServiceLayoutVersion(int)">setServiceLayoutVersion</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#setStorageInfo(org.apache.hadoop.hdfs.server.common.StorageInfo)">setStorageInfo</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#toColonSeparatedString()">toColonSeparatedString</a>, <a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#versionSupportsFederation(java.util.Map)">versionSupportsFederation</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></h3>
<code><a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#clone()" title="class or interface in java.lang">clone</a>, <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#equals(java.lang.Object)" title="class or interface in java.lang">equals</a>, <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#finalize()" title="class or interface in java.lang">finalize</a>, <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#getClass()" title="class or interface in java.lang">getClass</a>, <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#hashCode()" title="class or interface in java.lang">hashCode</a>, <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#notify()" title="class or interface in java.lang">notify</a>, <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#notifyAll()" title="class or interface in java.lang">notifyAll</a>, <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#wait()" title="class or interface in java.lang">wait</a>, <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#wait(long)" title="class or interface in java.lang">wait</a>, <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#wait(long,%20int)" title="class or interface in java.lang">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="TRASH_ROOT_DIR">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>TRASH_ROOT_DIR</h4>
<pre>static final&nbsp;<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> <a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.66">TRASH_ROOT_DIR</a></pre>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../../../../constant-values.html#org.apache.hadoop.hdfs.server.datanode.BlockPoolSliceStorage.TRASH_ROOT_DIR">Constant Field Values</a></dd></dl>
</li>
</ul>
<a name="ROLLING_UPGRADE_MARKER_FILE">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>ROLLING_UPGRADE_MARKER_FILE</h4>
<pre>static final&nbsp;<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> <a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.78">ROLLING_UPGRADE_MARKER_FILE</a></pre>
<div class="block">A marker file that is created on each root directory if a rolling upgrade
 is in progress. The NN does not inform the DN when a rolling upgrade is
 finalized. All the DN can infer is whether or not a rolling upgrade is
 currently in progress. When the rolling upgrade is not in progress:
   1. If the marker file is present, then a rolling upgrade just completed.
      If a 'previous' directory exists, it can be deleted now.
   2. If the marker file is absent, then a regular upgrade may be in
      progress. Do not delete the 'previous' directory.</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../../../../constant-values.html#org.apache.hadoop.hdfs.server.datanode.BlockPoolSliceStorage.ROLLING_UPGRADE_MARKER_FILE">Constant Field Values</a></dd></dl>
</li>
</ul>
<a name="BLOCK_POOL_ID_PATTERN_BASE">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>BLOCK_POOL_ID_PATTERN_BASE</h4>
<pre>private static final&nbsp;<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> <a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.80">BLOCK_POOL_ID_PATTERN_BASE</a></pre>
</li>
</ul>
<a name="BLOCK_POOL_PATH_PATTERN">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>BLOCK_POOL_PATH_PATTERN</h4>
<pre>private static final&nbsp;<a href="https://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html?is-external=true" title="class or interface in java.util.regex">Pattern</a> <a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.85">BLOCK_POOL_PATH_PATTERN</a></pre>
</li>
</ul>
<a name="BLOCK_POOL_CURRENT_PATH_PATTERN">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>BLOCK_POOL_CURRENT_PATH_PATTERN</h4>
<pre>private static final&nbsp;<a href="https://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html?is-external=true" title="class or interface in java.util.regex">Pattern</a> <a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.88">BLOCK_POOL_CURRENT_PATH_PATTERN</a></pre>
</li>
</ul>
<a name="BLOCK_POOL_TRASH_PATH_PATTERN">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>BLOCK_POOL_TRASH_PATH_PATTERN</h4>
<pre>private static final&nbsp;<a href="https://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html?is-external=true" title="class or interface in java.util.regex">Pattern</a> <a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.91">BLOCK_POOL_TRASH_PATH_PATTERN</a></pre>
</li>
</ul>
<a name="blockpoolID">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>blockpoolID</h4>
<pre>private&nbsp;<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> <a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.94">blockpoolID</a></pre>
</li>
</ul>
<a name="storagesWithRollingUpgradeMarker">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>storagesWithRollingUpgradeMarker</h4>
<pre>private static&nbsp;<a href="https://docs.oracle.com/javase/7/docs/api/java/util/Set.html?is-external=true" title="class or interface in java.util">Set</a>&lt;<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&gt; <a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.105">storagesWithRollingUpgradeMarker</a></pre>
<div class="block">These maps are used as an optimization to avoid one filesystem operation
 per storage on each heartbeat response.</div>
</li>
</ul>
<a name="storagesWithoutRollingUpgradeMarker">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>storagesWithoutRollingUpgradeMarker</h4>
<pre>private static&nbsp;<a href="https://docs.oracle.com/javase/7/docs/api/java/util/Set.html?is-external=true" title="class or interface in java.util">Set</a>&lt;<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&gt; <a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.106">storagesWithoutRollingUpgradeMarker</a></pre>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="BlockPoolSliceStorage(org.apache.hadoop.hdfs.server.common.StorageInfo, java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>BlockPoolSliceStorage</h4>
<pre>public&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.96">BlockPoolSliceStorage</a>(<a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html" title="class in org.apache.hadoop.hdfs.server.common">StorageInfo</a>&nbsp;storageInfo,
                     <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;bpid)</pre>
</li>
</ul>
<a name="BlockPoolSliceStorage(int, java.lang.String, long, java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>BlockPoolSliceStorage</h4>
<pre><a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.108">BlockPoolSliceStorage</a>(int&nbsp;namespaceID,
                     <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;bpID,
                     long&nbsp;cTime,
                     <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;clusterId)</pre>
</li>
</ul>
<a name="BlockPoolSliceStorage()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>BlockPoolSliceStorage</h4>
<pre>private&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.121">BlockPoolSliceStorage</a>()</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="addStorageDir(org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>addStorageDir</h4>
<pre>public&nbsp;void&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.130">addStorageDir</a>(<a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&nbsp;sd)</pre>
<dl>
<dt><strong>Overrides:</strong></dt>
<dd><code><a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#addStorageDir(org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">addStorageDir</a></code>&nbsp;in class&nbsp;<code><a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html" title="class in org.apache.hadoop.hdfs.server.common">Storage</a></code></dd>
</dl>
</li>
</ul>
<a name="loadStorageDirectory(org.apache.hadoop.hdfs.server.datanode.DataNode, org.apache.hadoop.hdfs.server.protocol.NamespaceInfo, java.io.File, org.apache.hadoop.hdfs.server.common.HdfsServerConstants.StartupOption)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>loadStorageDirectory</h4>
<pre>private&nbsp;<a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.144">loadStorageDirectory</a>(<a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/DataNode.html" title="class in org.apache.hadoop.hdfs.server.datanode">DataNode</a>&nbsp;datanode,
                                            <a href="../../../../../../org/apache/hadoop/hdfs/server/protocol/NamespaceInfo.html" title="class in org.apache.hadoop.hdfs.server.protocol">NamespaceInfo</a>&nbsp;nsInfo,
                                            <a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;dataDir,
                                            <a href="../../../../../../org/apache/hadoop/hdfs/server/common/HdfsServerConstants.StartupOption.html" title="enum in org.apache.hadoop.hdfs.server.common">HdfsServerConstants.StartupOption</a>&nbsp;startOpt)
                                               throws <a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block">Load one storage directory. Recover from previous transitions if required.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>datanode</code> - datanode instance</dd><dd><code>nsInfo</code> - namespace information</dd><dd><code>dataDir</code> - the root path of the storage directory</dd><dd><code>startOpt</code> - startup option</dd>
<dt><span class="strong">Returns:</span></dt><dd>the StorageDirectory successfully loaded.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code></dd></dl>
</li>
</ul>
<a name="loadBpStorageDirectories(org.apache.hadoop.hdfs.server.datanode.DataNode, org.apache.hadoop.hdfs.server.protocol.NamespaceInfo, java.util.Collection, org.apache.hadoop.hdfs.server.common.HdfsServerConstants.StartupOption)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>loadBpStorageDirectories</h4>
<pre><a href="https://docs.oracle.com/javase/7/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&gt;&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.203">loadBpStorageDirectories</a>(<a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/DataNode.html" title="class in org.apache.hadoop.hdfs.server.datanode">DataNode</a>&nbsp;datanode,
                                                      <a href="../../../../../../org/apache/hadoop/hdfs/server/protocol/NamespaceInfo.html" title="class in org.apache.hadoop.hdfs.server.protocol">NamespaceInfo</a>&nbsp;nsInfo,
                                                      <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Collection.html?is-external=true" title="class or interface in java.util">Collection</a>&lt;<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&gt;&nbsp;dataDirs,
                                                      <a href="../../../../../../org/apache/hadoop/hdfs/server/common/HdfsServerConstants.StartupOption.html" title="enum in org.apache.hadoop.hdfs.server.common">HdfsServerConstants.StartupOption</a>&nbsp;startOpt)
                                                  throws <a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block">Analyze and load storage directories. Recover from previous transitions if
 required.

 The block pool storages are either all analyzed or none of them is loaded.
 Therefore, a failure on loading any block pool storage results a faulty
 data volume.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>datanode</code> - Datanode to which this storage belongs to</dd><dd><code>nsInfo</code> - namespace information</dd><dd><code>dataDirs</code> - storage directories of block pool</dd><dd><code>startOpt</code> - startup option</dd>
<dt><span class="strong">Returns:</span></dt><dd>an array of loaded block pool directories.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code> - on error</dd></dl>
</li>
</ul>
<a name="recoverTransitionRead(org.apache.hadoop.hdfs.server.datanode.DataNode, org.apache.hadoop.hdfs.server.protocol.NamespaceInfo, java.util.Collection, org.apache.hadoop.hdfs.server.common.HdfsServerConstants.StartupOption)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>recoverTransitionRead</h4>
<pre>void&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.239">recoverTransitionRead</a>(<a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/DataNode.html" title="class in org.apache.hadoop.hdfs.server.datanode">DataNode</a>&nbsp;datanode,
                         <a href="../../../../../../org/apache/hadoop/hdfs/server/protocol/NamespaceInfo.html" title="class in org.apache.hadoop.hdfs.server.protocol">NamespaceInfo</a>&nbsp;nsInfo,
                         <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Collection.html?is-external=true" title="class or interface in java.util">Collection</a>&lt;<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&gt;&nbsp;dataDirs,
                         <a href="../../../../../../org/apache/hadoop/hdfs/server/common/HdfsServerConstants.StartupOption.html" title="enum in org.apache.hadoop.hdfs.server.common">HdfsServerConstants.StartupOption</a>&nbsp;startOpt)
                     throws <a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block">Analyze storage directories. Recover from previous transitions if required.

 The block pool storages are either all analyzed or none of them is loaded.
 Therefore, a failure on loading any block pool storage results a faulty
 data volume.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>datanode</code> - Datanode to which this storage belongs to</dd><dd><code>nsInfo</code> - namespace information</dd><dd><code>dataDirs</code> - storage directories of block pool</dd><dd><code>startOpt</code> - startup option</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code> - on error</dd></dl>
</li>
</ul>
<a name="format(java.io.File, org.apache.hadoop.hdfs.server.protocol.NamespaceInfo)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>format</h4>
<pre>void&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.254">format</a>(<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;dnCurDir,
          <a href="../../../../../../org/apache/hadoop/hdfs/server/protocol/NamespaceInfo.html" title="class in org.apache.hadoop.hdfs.server.protocol">NamespaceInfo</a>&nbsp;nsInfo)
      throws <a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block">Format a block pool slice storage.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>dnCurDir</code> - DataStorage current directory</dd><dd><code>nsInfo</code> - the name space info</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code> - Signals that an I/O exception has occurred.</dd></dl>
</li>
</ul>
<a name="format(org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory, org.apache.hadoop.hdfs.server.protocol.NamespaceInfo)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>format</h4>
<pre>private&nbsp;void&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.266">format</a>(<a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&nbsp;bpSdir,
          <a href="../../../../../../org/apache/hadoop/hdfs/server/protocol/NamespaceInfo.html" title="class in org.apache.hadoop.hdfs.server.protocol">NamespaceInfo</a>&nbsp;nsInfo)
             throws <a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block">Format a block pool slice storage.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>bpSdir</code> - the block pool storage</dd><dd><code>nsInfo</code> - the name space info</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code> - Signals that an I/O exception has occurred.</dd></dl>
</li>
</ul>
<a name="remove(java.io.File)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>remove</h4>
<pre>void&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.282">remove</a>(<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;absPathToRemove)</pre>
<div class="block">Remove block pool level storage directory.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>absPathToRemove</code> - the absolute path of the root for the block pool
                        level storage to remove.</dd></dl>
</li>
</ul>
<a name="setPropertiesFromFields(java.util.Properties, org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setPropertiesFromFields</h4>
<pre>protected&nbsp;void&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.300">setPropertiesFromFields</a>(<a href="https://docs.oracle.com/javase/7/docs/api/java/util/Properties.html?is-external=true" title="class or interface in java.util">Properties</a>&nbsp;props,
                           <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&nbsp;sd)
                                throws <a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block">Set layoutVersion, namespaceID and blockpoolID into block pool storage
 VERSION file</div>
<dl>
<dt><strong>Overrides:</strong></dt>
<dd><code><a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#setPropertiesFromFields(java.util.Properties,%20org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">setPropertiesFromFields</a></code>&nbsp;in class&nbsp;<code><a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html" title="class in org.apache.hadoop.hdfs.server.common">Storage</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>props</code> - the Properties object to write into</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code></dd></dl>
</li>
</ul>
<a name="setBlockPoolID(java.io.File, java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setBlockPoolID</h4>
<pre>private&nbsp;void&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.309">setBlockPoolID</a>(<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;storage,
                  <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;bpid)
                     throws <a href="../../../../../../org/apache/hadoop/hdfs/server/common/InconsistentFSStateException.html" title="class in org.apache.hadoop.hdfs.server.common">InconsistentFSStateException</a></pre>
<div class="block">Validate and set block pool ID</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code><a href="../../../../../../org/apache/hadoop/hdfs/server/common/InconsistentFSStateException.html" title="class in org.apache.hadoop.hdfs.server.common">InconsistentFSStateException</a></code></dd></dl>
</li>
</ul>
<a name="setFieldsFromProperties(java.util.Properties, org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setFieldsFromProperties</h4>
<pre>protected&nbsp;void&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.324">setFieldsFromProperties</a>(<a href="https://docs.oracle.com/javase/7/docs/api/java/util/Properties.html?is-external=true" title="class or interface in java.util">Properties</a>&nbsp;props,
                           <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&nbsp;sd)
                                throws <a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block"><strong>Description copied from class:&nbsp;<code><a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#setFieldsFromProperties(java.util.Properties,%20org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">StorageInfo</a></code></strong></div>
<div class="block">Get common storage fields.
 Should be overloaded if additional fields need to be get.</div>
<dl>
<dt><strong>Overrides:</strong></dt>
<dd><code><a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#setFieldsFromProperties(java.util.Properties,%20org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">setFieldsFromProperties</a></code>&nbsp;in class&nbsp;<code><a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html" title="class in org.apache.hadoop.hdfs.server.common">StorageInfo</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>props</code> - properties</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code> - on error</dd></dl>
</li>
</ul>
<a name="doTransition(org.apache.hadoop.hdfs.server.datanode.DataNode, org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory, org.apache.hadoop.hdfs.server.protocol.NamespaceInfo, org.apache.hadoop.hdfs.server.common.HdfsServerConstants.StartupOption)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>doTransition</h4>
<pre>private&nbsp;void&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.347">doTransition</a>(<a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/DataNode.html" title="class in org.apache.hadoop.hdfs.server.datanode">DataNode</a>&nbsp;datanode,
                <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&nbsp;sd,
                <a href="../../../../../../org/apache/hadoop/hdfs/server/protocol/NamespaceInfo.html" title="class in org.apache.hadoop.hdfs.server.protocol">NamespaceInfo</a>&nbsp;nsInfo,
                <a href="../../../../../../org/apache/hadoop/hdfs/server/common/HdfsServerConstants.StartupOption.html" title="enum in org.apache.hadoop.hdfs.server.common">HdfsServerConstants.StartupOption</a>&nbsp;startOpt)
                   throws <a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block">Analyze whether a transition of the BP state is required and
 perform it if necessary.
 <br>
 Rollback if previousLV >= LAYOUT_VERSION && prevCTime <= namenode.cTime.
 Upgrade if this.LV > LAYOUT_VERSION || this.cTime < namenode.cTime Regular
 startup if this.LV = LAYOUT_VERSION && this.cTime = namenode.cTime</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>sd</code> - storage directory <SD>/current/<bpid></dd><dd><code>nsInfo</code> - namespace info</dd><dd><code>startOpt</code> - startup option</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code></dd></dl>
</li>
</ul>
<a name="doUpgrade(org.apache.hadoop.hdfs.server.datanode.DataNode, org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory, org.apache.hadoop.hdfs.server.protocol.NamespaceInfo)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>doUpgrade</h4>
<pre>void&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.412">doUpgrade</a>(<a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/DataNode.html" title="class in org.apache.hadoop.hdfs.server.datanode">DataNode</a>&nbsp;datanode,
             <a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&nbsp;bpSd,
             <a href="../../../../../../org/apache/hadoop/hdfs/server/protocol/NamespaceInfo.html" title="class in org.apache.hadoop.hdfs.server.protocol">NamespaceInfo</a>&nbsp;nsInfo)
         throws <a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block">Upgrade to any release after 0.22 (0.22 included) release e.g. 0.22 => 0.23
 Upgrade procedure is as follows:
 <ol>
 <li>If <SD>/current/<bpid>/previous exists then delete it</li>
 <li>Rename <SD>/current/<bpid>/current to
 <SD>/current/bpid/current/previous.tmp</li>
 <li>Create new <SD>current/<bpid>/current directory</li>
 <ol>
 <li>Hard links for block files are created from previous.tmp to current</li>
 <li>Save new version file in current directory</li>
 </ol>
 <li>Rename previous.tmp to previous</li> </ol></div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>bpSd</code> - storage directory <SD>/current/<bpid></dd><dd><code>nsInfo</code> - Namespace Info from the namenode</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code> - on error</dd></dl>
</li>
</ul>
<a name="cleanupDetachDir(java.io.File)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>cleanupDetachDir</h4>
<pre>private&nbsp;void&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.472">cleanupDetachDir</a>(<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;detachDir)
                       throws <a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block">Cleanup the detachDir.
 
 If the directory is not empty report an error; Otherwise remove the
 directory.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>detachDir</code> - detach directory</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code> - if the directory is not empty or it can not be removed</dd></dl>
</li>
</ul>
<a name="restoreBlockFilesFromTrash(java.io.File)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>restoreBlockFilesFromTrash</h4>
<pre>private&nbsp;int&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.492">restoreBlockFilesFromTrash</a>(<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;trashRoot)
                                throws <a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block">Restore all files from the trash directory to their corresponding
 locations under current/</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code></dd></dl>
</li>
</ul>
<a name="doRollback(org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory, org.apache.hadoop.hdfs.server.protocol.NamespaceInfo)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>doRollback</h4>
<pre>void&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.545">doRollback</a>(<a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&nbsp;bpSd,
              <a href="../../../../../../org/apache/hadoop/hdfs/server/protocol/NamespaceInfo.html" title="class in org.apache.hadoop.hdfs.server.protocol">NamespaceInfo</a>&nbsp;nsInfo)
          throws <a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code></dd></dl>
</li>
</ul>
<a name="doFinalize(java.io.File)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>doFinalize</h4>
<pre>void&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.590">doFinalize</a>(<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;dnCurDir)
          throws <a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code></dd></dl>
</li>
</ul>
<a name="linkAllBlocks(org.apache.hadoop.hdfs.server.datanode.DataNode, java.io.File, java.io.File)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>linkAllBlocks</h4>
<pre>private&nbsp;void&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.634">linkAllBlocks</a>(<a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/DataNode.html" title="class in org.apache.hadoop.hdfs.server.datanode">DataNode</a>&nbsp;datanode,
                 <a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;fromDir,
                 <a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;toDir)
                    throws <a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block">Hardlink all finalized and RBW blocks in fromDir to toDir</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>fromDir</code> - directory where the snapshot is stored</dd><dd><code>toDir</code> - the current data directory</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code> - if error occurs during hardlink</dd></dl>
</li>
</ul>
<a name="getDataNodeStorageRoot(java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getDataNodeStorageRoot</h4>
<pre>private static&nbsp;<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.650">getDataNodeStorageRoot</a>(<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;bpRoot)</pre>
<div class="block">gets the data node storage directory based on block pool storage</div>
</li>
</ul>
<a name="toString()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>toString</h4>
<pre>public&nbsp;<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.660">toString</a>()</pre>
<dl>
<dt><strong>Overrides:</strong></dt>
<dd><code><a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html#toString()">toString</a></code>&nbsp;in class&nbsp;<code><a href="../../../../../../org/apache/hadoop/hdfs/server/common/StorageInfo.html" title="class in org.apache.hadoop.hdfs.server.common">StorageInfo</a></code></dd>
</dl>
</li>
</ul>
<a name="getBpRoot(java.lang.String, java.io.File)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getBpRoot</h4>
<pre>public static&nbsp;<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.670">getBpRoot</a>(<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;bpID,
             <a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;dnCurDir)</pre>
<div class="block">Get a block pool storage root based on data node storage root</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>bpID</code> - block pool ID</dd><dd><code>dnCurDir</code> - data node storage root directory</dd>
<dt><span class="strong">Returns:</span></dt><dd>root directory for block pool storage</dd></dl>
</li>
</ul>
<a name="isPreUpgradableLayout(org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isPreUpgradableLayout</h4>
<pre>public&nbsp;boolean&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.675">isPreUpgradableLayout</a>(<a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&nbsp;sd)
                              throws <a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block"><strong>Description copied from class:&nbsp;<code><a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#isPreUpgradableLayout(org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">Storage</a></code></strong></div>
<div class="block">Return true if the layout of the given storage directory is from a version
 of Hadoop prior to the introduction of the "current" and "previous"
 directories which allow upgrade and rollback.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html#isPreUpgradableLayout(org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">isPreUpgradableLayout</a></code>&nbsp;in class&nbsp;<code><a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.html" title="class in org.apache.hadoop.hdfs.server.common">Storage</a></code></dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code></dd></dl>
</li>
</ul>
<a name="getTrashRootDir(org.apache.hadoop.hdfs.server.common.Storage.StorageDirectory)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getTrashRootDir</h4>
<pre>private&nbsp;<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.679">getTrashRootDir</a>(<a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&nbsp;sd)</pre>
</li>
</ul>
<a name="isTrashAllowed(java.io.File)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isTrashAllowed</h4>
<pre>public&nbsp;boolean&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.689">isTrashAllowed</a>(<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;blockFile)</pre>
<div class="block">Determine whether we can use trash for the given blockFile. Trash
 is disallowed if a 'previous' directory exists for the
 storage directory containing the block.</div>
</li>
</ul>
<a name="getTrashDirectory(java.io.File)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getTrashDirectory</h4>
<pre>public&nbsp;<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.704">getTrashDirectory</a>(<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;blockFile)</pre>
<div class="block">Get a target subdirectory under trash/ for a given block file that is being
 deleted.

 The subdirectory structure under trash/ mirrors that under current/ to keep
 implicit memory of where the files are to be restored (if necessary).</div>
<dl><dt><span class="strong">Returns:</span></dt><dd>the trash directory for a given block file that is being deleted.</dd></dl>
</li>
</ul>
<a name="getRestoreDirectory(java.io.File)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getRestoreDirectory</h4>
<pre><a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.723">getRestoreDirectory</a>(<a href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;blockFile)</pre>
<div class="block">Get a target subdirectory under current/ for a given block file that is being
 restored from trash.

 The subdirectory structure under trash/ mirrors that under current/ to keep
 implicit memory of where the files are to be restored.</div>
<dl><dt><span class="strong">Returns:</span></dt><dd>the target directory to restore a previously deleted block file.</dd></dl>
</li>
</ul>
<a name="restoreTrash()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>restoreTrash</h4>
<pre>public&nbsp;void&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.733">restoreTrash</a>()</pre>
<div class="block">Delete all files and directories in the trash directories.</div>
</li>
</ul>
<a name="trashEnabled()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>trashEnabled</h4>
<pre>public&nbsp;boolean&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.748">trashEnabled</a>()</pre>
<div class="block">trash is enabled if at least one storage directory contains trash root</div>
</li>
</ul>
<a name="setRollingUpgradeMarkers(java.util.List)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setRollingUpgradeMarkers</h4>
<pre>public&nbsp;void&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.761">setRollingUpgradeMarkers</a>(<a href="https://docs.oracle.com/javase/7/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&gt;&nbsp;dnStorageDirs)
                              throws <a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block">Create a rolling upgrade marker file for each BP storage root, if it
 does not exist already.</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code></dd></dl>
</li>
</ul>
<a name="clearRollingUpgradeMarkers(java.util.List)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>clearRollingUpgradeMarkers</h4>
<pre>public&nbsp;void&nbsp;<a href="../../../../../../src-html/org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html#line.783">clearRollingUpgradeMarkers</a>(<a href="https://docs.oracle.com/javase/7/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="../../../../../../org/apache/hadoop/hdfs/server/common/Storage.StorageDirectory.html" title="class in org.apache.hadoop.hdfs.server.common">Storage.StorageDirectory</a>&gt;&nbsp;dnStorageDirs)
                                throws <a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block">Check whether the rolling upgrade marker file exists for each BP storage
 root. If it does exist, then the marker file is cleared and more
 importantly the layout upgrade is finalized.</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code></dd></dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/BlockPoolSliceStorage.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockPoolManager.html" title="class in org.apache.hadoop.hdfs.server.datanode"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../../../org/apache/hadoop/hdfs/server/datanode/BlockReceiver.html" title="class in org.apache.hadoop.hdfs.server.datanode"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?org/apache/hadoop/hdfs/server/datanode/BlockPoolSliceStorage.html" target="_top">Frames</a></li>
<li><a href="BlockPoolSliceStorage.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested_classes_inherited_from_class_org.apache.hadoop.hdfs.server.common.Storage">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
